{% extends 'base.html.twig' %}
{% block body %}
    <div class="container">
        <div id="mapid" class="map"></div>
        <p> Info: W prawym górnym rogu mapy jest ikonka "Draw a polygon". Naciśnij ją, a następnie zaznacz dany obszar
            na mapie.</p>
        {{ form_start(form) }}
        {{ form_errors(form.latLng) }}
        {{ form_row(form.name) }}
        {{ form_row(form.tags, {
            label: 'Tagi (opcjonalnie)'
        }) }}
        {{ form_row(form.status, {
            label: 'Status (opcjonalnie)'
        }) }}
        {{ form_row(form.description, {
            label: 'Opis (opcjonalnie)'
        }) }}
        <button type="submit" class="btn btn-primary" formnovalidate>Zapisz</button>
        {{ form_end(form) }}
    </div>
{% endblock %}
{% block javascripts %}
    <script>
        {% for area_in_loop in areas %}
            {% if area_in_loop.latLng %}
                {% if area_in_loop.id  != area.id %}
                    L.polygon([{{  area_in_loop.latLng }}]).addTo(map);
                {% endif %}
            {% endif %}
        {% endfor %}

        var editableLayers = new L.FeatureGroup();
        var edit = L.polygon([{{  area.latLng }}]).setStyle({
            color: 'red'
        });
        editableLayers.addLayer(edit);

        map.addLayer(editableLayers);

        var drawPluginOptions = {
            position: 'topright',
            draw: {
                polygon: false,
                polyline: false,
                circle: false,
                circlemarker: false,
                rectangle: false,
                marker: false,
            },
            edit: {
                featureGroup: editableLayers,
                remove: false
            }
        };

        let drawControl = new L.Control.Draw(drawPluginOptions);
        map.addControl(drawControl);

        map.on('draw:edited', function (e) {
            let layers = e.layers;
            let objt = layers._layers;
            let normalize  = objt[function() { for (var k in objt) return k }()]._latlngs;

            let newArr = normalize[0].map(function (val) {
                return Array(val.lat, val.lng);
            })

            document.getElementById('area_latLng').value = JSON.stringify(newArr);
        });
    </script>
{% endblock %}